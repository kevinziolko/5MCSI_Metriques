<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Évolution des Commits & Zoom sur une Journée</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
    <div id="chart_div" style="width: 800px; height: 500px;"></div>
    <div id="daily_chart_div" style="width: 800px; height: 500px; margin-top: 20px;"></div>
    <div id="total_commits" style="margin-top: 20px;"></div>
    <script>
        // Charger la bibliothèque de graphiques Google
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawCharts);

        function drawCharts() {
            fetch('https://api.github.com/repos/kevinziolko/5MCSI_Metriques/commits')
                .then(response => response.json())
                .then(data => {
                    const commitCounts = {};
                    const dailyCommits = [];
                    let totalCommits = 0;

                    data.forEach(commit => {
                        const commitDate = new Date(commit.commit.author.date);
                        const dateKey = commitDate.toISOString().split('T')[0];
                        const hour = commitDate.getHours();

                        if (!commitCounts[dateKey]) {
                            commitCounts[dateKey] = 0;
                        }
                        commitCounts[dateKey]++;

                        // Pour le graphique du 12/02/2024 de 8h à 13h
                        if (dateKey === '2024-02-12' && hour >= 8 && hour < 13) {
                            dailyCommits.push([hour, 1]); // Ajouter 1 pour chaque commit à cette heure
                        }

                        totalCommits++;
                    });

                    const commitData = Object.keys(commitCounts).map(date => [new Date(date), commitCounts[date]]);
                    drawEvolutionChart(commitData);
                    drawDailyChart(dailyCommits);
                    document.getElementById('total_commits').innerText = "Nombre total de commits effectués : " + totalCommits;
                })
                .catch(error => console.error('Erreur lors de la récupération des données:', error));
        }

        function drawEvolutionChart(commitData) {
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('date', 'Date');
            dataTable.addColumn('number', 'Commits');
            dataTable.addRows(commitData);

            const options = {
                title: 'Évolution des Commits dans le Temps',
                curveType: 'function',
                legend: { position: 'bottom' },
                hAxis: {title: 'Date', format: 'M/d/yy'},
                vAxis: {title: 'Nombre de commits'},
                colors: ['#a52714'],
            };

            const chart = new google.visualization.LineChart(document.getElementById('chart_div'));
            chart.draw(dataTable, options);
        }

        function drawDailyChart(dailyCommits) {
            if (dailyCommits.length === 0) {
                document.getElementById('daily_chart_div').innerText = "Pas de commits à afficher pour cette période.";
                return;
            }

            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('number', 'Heure');
            dataTable.addColumn('number', 'Commits');
            dataTable.addRows(dailyCommits);

            const options = {
                title: 'Zoom sur les Commits sur la journée du 12/02/2024',
                hAxis: {title: 'Heure', ticks: [8, 9, 10, 11, 12]},
                vAxis: {title: 'Nombre de commits', minValue: 0},
                legend: 'none',
                colors: ['#4285F4'],
            };

            const chart = new google.visualization.ColumnChart(document.getElementById('daily_chart_div'));
            chart.draw(dataTable, options);
        }
    </script>
</body>
</html>
