<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Évolution des Commits & Zoom sur une Journée</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
    <div id="chart_div" style="width: 800px; height: 500px;"></div>
    <div id="daily_chart_div" style="width: 800px; height: 500px; margin-top: 20px;"></div>
    <div id="total_commits" style="margin-top: 20px;"></div>
    <script>
        // Charger la bibliothèque de graphiques Google
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawCharts);

        function drawCharts() {
            fetch('https://api.github.com/repos/kevinziolko/5MCSI_Metriques/commits')
                .then(response => response.json())
                .then(data => {
                    const commitCounts = {};
                    const hourlyCommits = new Array(5).fill(0); // Préparer un tableau pour les heures de 8 à 12 inclus
                    let totalCommits = 0;

                    data.forEach(commit => {
                        const commitDate = new Date(commit.commit.author.date);
                        const dateKey = commitDate.toISOString().split('T')[0];
                        const hour = commitDate.getHours();

                        if (!commitCounts[dateKey]) {
                            commitCounts[dateKey] = 0;
                        }
                        commitCounts[dateKey]++;

                        // Pour le graphique du 12/02/2024 de 8h à 13h
                        if (dateKey === '2024-02-12' && hour >= 8 && hour < 13) {
                            hourlyCommits[hour - 8]++; // Incrémente le compteur de commits pour l'heure correspondante
                        }

                        totalCommits++;
                    });

                    const commitData = Object.keys(commitCounts).map(date => [new Date(date), commitCounts[date]]);
                    drawEvolutionChart(commitData);
                    drawDailyChart(hourlyCommits);
                    document.getElementById('total_commits').innerText = "Nombre total de commits effectués : " + totalCommits;
                })
                .catch(error => console.error('Erreur lors de la récupération des données:', error));
        }

        function drawEvolutionChart(commitData) {
            // Configuration pour le premier graphique (identique à l'exemple précédent)
            // ...
        }

        function drawDailyChart(hourlyCommits) {
            // Convertir les données pour Google Charts
            const dailyCommitsData = hourlyCommits.map((count, index) => [8 + index, count]);
            if (dailyCommitsData.length === 0) {
                document.getElementById('daily_chart_div').innerText = "Pas de commits à afficher pour cette période.";
                return;
            }

            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('number', 'Heure');
            dataTable.addColumn('number', 'Commits');
            dataTable.addRows(dailyCommitsData);

            const options = {
                title: 'Zoom sur les Commits sur la journée du 12/02/2024',
                hAxis: {
                    title: 'Heure',
                    ticks: [8, 9, 10, 11, 12], // Définir explicitement les marques d'heure pour la clarté
                },
                vAxis: {
                    title: 'Nombre de commits',
                    minValue: 0,
                    maxValue: 15, // Limite supérieure pour l'affichage des valeurs
                    format: '0' // Forcer le formatage en nombres entiers
                },
                legend: 'none',
                colors: ['#4285F4'],
            };

            const chart = new google.visualization.ColumnChart(document.getElementById('daily_chart_div'));
            chart.draw(dataTable, options);
        }
    </script>
</body>
</html>
